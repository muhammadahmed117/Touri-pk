{% extends 'base.html' %}
{% load static %}

{% block title %}Login - TouriPK{% endblock %}

{% block content %}
<!-- Modern Gradient Background -->
<div class="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 py-6 sm:py-12 px-4">
    <div class="container mx-auto">
        <div class="flex justify-center">
            <div class="w-full max-w-md">
                <!-- Animated Card with Tailwind -->
                <div class="bg-white rounded-2xl sm:rounded-3xl shadow-2xl overflow-hidden transform transition-all duration-300 hover:shadow-purple-200 hover:scale-[1.02] animate-fade-in">
                    <!-- Header with Gradient -->
                    <div class="bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 p-6 sm:p-8 text-center relative overflow-hidden">
                        <div class="absolute inset-0 bg-black opacity-10"></div>
                        <div class="relative z-10">
                            <h2 class="text-3xl sm:text-4xl font-extrabold text-white mb-2">Welcome</h2>
                            <p class="text-blue-100 text-base sm:text-lg">Sign in to continue your journey</p>
                        </div>
                        <!-- Decorative waves -->
                        <div class="absolute bottom-0 left-0 right-0">
                            <svg viewBox="0 0 1440 100" class="w-full h-6 sm:h-8">
                                <path fill="#ffffff" d="M0,50 Q360,0 720,50 T1440,50 L1440,100 L0,100 Z"></path>
                            </svg>
                        </div>
                    </div>
                    
                    <div class="p-6 sm:p-8">
                        {% if messages %}
                        {% for message in messages %}
                        <div class="mb-4 p-4 rounded-xl bg-gradient-to-r {% if message.tags == 'success' %}from-green-50 to-emerald-50 border-l-4 border-green-500 text-green-800{% elif message.tags == 'error' %}from-red-50 to-rose-50 border-l-4 border-red-500 text-red-800{% else %}from-blue-50 to-cyan-50 border-l-4 border-blue-500 text-blue-800{% endif %} animate-slide-up">
                            <div class="flex items-center justify-between">
                                <span class="flex items-center gap-2">
                                    <i class="fas {% if message.tags == 'success' %}fa-check-circle{% elif message.tags == 'error' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %}"></i>
                                    {{ message }}
                                </span>
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>
                        </div>
                        {% endfor %}
                        {% endif %}

                        <form method="post" novalidate class="space-y-4 sm:space-y-6">
                            {% csrf_token %}

                            {% if form.errors or form.non_field_errors %}
                            <div class="p-4 rounded-xl bg-gradient-to-r from-red-50 to-rose-50 border-2 border-red-500 shadow-lg animate-fade-in">
                                <div class="flex items-start gap-3">
                                    <i class="fas fa-exclamation-triangle text-2xl text-red-600"></i>
                                    <div class="flex-1">
                                        <h5 class="font-bold text-base text-red-800 mb-2">Login Failed</h5>
                                        <ul class="text-sm text-red-700 space-y-1 list-none">
                                            {% if form.non_field_errors %}
                                                {% for error in form.non_field_errors %}
                                                <li><i class="fas fa-times-circle me-2"></i>{{ error }}</li>
                                                {% endfor %}
                                            {% endif %}
                                            {% if form.username.errors %}
                                                {% for error in form.username.errors %}
                                                <li><i class="fas fa-times-circle me-2"></i><strong>Username/Email:</strong> {{ error }}</li>
                                                {% endfor %}
                                            {% endif %}
                                            {% if form.password.errors %}
                                                {% for error in form.password.errors %}
                                                <li><i class="fas fa-times-circle me-2"></i><strong>Password:</strong> {{ error }}</li>
                                                {% endfor %}
                                            {% endif %}
                                            {% if not form.non_field_errors and not form.username.errors and not form.password.errors %}
                                                <li><i class="fas fa-times-circle me-2"></i>Invalid email or password. Please try again.</li>
                                            {% endif %}
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Email or Username Field with Tailwind -->
                            <div class="relative group">
                                <label for="{{ form.username.id_for_label }}" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
                                    <i class="fas fa-user text-purple-600"></i>
                                    {{ form.username.label }} <span class="text-red-500">*</span>
                                </label>
                                <div class="relative {% if form.username.errors %}border-2 border-red-500 rounded-xl{% endif %}">
                                    {{ form.username }}
                                    <div class="absolute inset-0 rounded-xl bg-gradient-to-r from-purple-400 to-pink-400 opacity-0 group-hover:opacity-20 transition-opacity duration-300 pointer-events-none"></div>
                                </div>
                                {% if form.username.errors %}
                                <div class="text-red-700 text-xs sm:text-sm mt-2 p-3 bg-red-50 rounded-lg border border-red-200 flex items-start gap-2 animate-slide-up">
                                    <i class="fas fa-exclamation-circle text-red-600 mt-0.5"></i>
                                    <div class="flex-1">
                                        {% for error in form.username.errors %}
                                        <div>{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                            </div>

                            <!-- Password Field with Tailwind -->
                            <div class="relative group">
                                <label for="{{ form.password.id_for_label }}" class="block text-xs sm:text-sm font-semibold text-gray-700 mb-2 flex items-center gap-2">
                                    <i class="fas fa-lock text-purple-600"></i>
                                    {{ form.password.label }} <span class="text-red-500">*</span>
                                </label>
                                <div class="relative {% if form.password.errors %}border-2 border-red-500 rounded-xl{% endif %}">
                                    {{ form.password }}
                                    <div class="absolute inset-0 rounded-xl bg-gradient-to-r from-purple-400 to-pink-400 opacity-0 group-hover:opacity-20 transition-opacity duration-300 pointer-events-none"></div>
                                </div>
                                {% if form.password.errors %}
                                <div class="text-red-700 text-xs sm:text-sm mt-2 p-3 bg-red-50 rounded-lg border border-red-200 flex items-start gap-2 animate-slide-up">
                                    <i class="fas fa-exclamation-circle text-red-600 mt-0.5"></i>
                                    <div class="flex-1">
                                        {% for error in form.password.errors %}
                                        <div>{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                                <div class="form-check mt-3 flex items-center gap-2">
                                    <input class="form-check-input toggle-password w-4 h-4 text-purple-600 rounded focus:ring-purple-500" type="checkbox" id="togglePasswordLogin"
                                        data-target="{{ form.password.id_for_label }}">
                                    <label class="text-xs sm:text-sm text-gray-600 cursor-pointer select-none" for="togglePasswordLogin">Show password</label>
                                </div>
                            </div>

                            <!-- Remember Me & Forgot Password with Tailwind -->
                            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 sm:gap-0">
                                <div class="form-check flex items-center gap-2">
                                    {{ form.remember_me }}
                                    <label class="text-xs sm:text-sm text-gray-600 cursor-pointer select-none" for="{{ form.remember_me.id_for_label }}">
                                        {{ form.remember_me.label }}
                                    </label>
                                </div>
                                <a href="{% url 'password_reset' %}" class="text-xs sm:text-sm font-medium text-purple-600 hover:text-purple-700 hover:underline transition-all duration-200">
                                    Forgot Password?
                                </a>
                            </div>

                            <!-- Submit Button with Tailwind Gradient -->
                            <button type="submit" class="w-full bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 hover:from-blue-700 hover:via-purple-700 hover:to-pink-700 text-white font-bold py-3 sm:py-4 px-6 rounded-lg sm:rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-200 flex items-center justify-center gap-2 group text-sm sm:text-base">
                                <i class="fas fa-sign-in-alt group-hover:rotate-12 transition-transform duration-200"></i>
                                <span>Sign In to Account</span>
                            </button>
                        </form>

                        <!-- Security Notice with Tailwind -->
                        <div class="mt-4 sm:mt-6 p-3 sm:p-4 rounded-lg sm:rounded-xl bg-gradient-to-r from-blue-50 to-cyan-50 border border-blue-200">
                            <div class="flex items-start gap-2 sm:gap-3">
                                <i class="fas fa-shield-alt text-blue-600 text-base sm:text-xl mt-0.5"></i>
                                <div>
                                    <p class="text-xs sm:text-sm text-blue-800 font-medium">Secure Login</p>
                                    <p class="text-xs text-blue-600 mt-1">Your session is encrypted and secure. For your security, logout when using shared computers.</p>
                                </div>
                            </div>
                        </div>

                        <div class="mt-6 sm:mt-8 text-center">
                            <div class="relative mb-4 sm:mb-6">
                                <div class="absolute inset-0 flex items-center">
                                    <div class="w-full border-t border-gray-300"></div>
                                </div>
                                <div class="relative flex justify-center text-xs sm:text-sm">
                                    <span class="px-3 sm:px-4 bg-white text-gray-500 font-medium">Don't have an account?</span>
                                </div>
                            </div>
                            
                            <!-- Registration Buttons with Tailwind -->
                            <div class="grid grid-cols-2 gap-2 sm:gap-3">
                                <a href="{% url 'register' %}" class="flex items-center justify-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 sm:py-3 bg-white border-2 border-blue-500 text-blue-600 font-semibold rounded-lg sm:rounded-xl hover:bg-blue-50 hover:border-blue-600 hover:scale-105 transform transition-all duration-200 shadow-md hover:shadow-lg group">
                                    <i class="fas fa-user text-sm sm:text-base group-hover:scale-110 transition-transform duration-200"></i>
                                    <span class="text-xs sm:text-sm">User</span>
                                </a>
                                <a href="{% url 'register_company' %}" class="flex items-center justify-center gap-1 sm:gap-2 px-3 sm:px-4 py-2 sm:py-3 bg-white border-2 border-green-500 text-green-600 font-semibold rounded-lg sm:rounded-xl hover:bg-green-50 hover:border-green-600 hover:scale-105 transform transition-all duration-200 shadow-md hover:shadow-lg group">
                                    <i class="fas fa-building text-sm sm:text-base group-hover:scale-110 transition-transform duration-200"></i>
                                    <span class="text-xs sm:text-sm">Company</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Security Features with Tailwind -->
                <div class="mt-6 sm:mt-8 grid grid-cols-3 gap-2 sm:gap-3">
                    <div class="bg-white rounded-xl sm:rounded-2xl shadow-lg p-3 sm:p-4 text-center transform hover:scale-105 transition-all duration-200 hover:shadow-xl">
                        <div class="inline-flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-blue-500 to-blue-600 rounded-full mb-1 sm:mb-2">
                            <i class="fas fa-lock text-white text-sm sm:text-lg"></i>
                        </div>
                        <p class="text-xs font-semibold text-gray-700">Encrypted</p>
                    </div>
                    <div class="bg-white rounded-xl sm:rounded-2xl shadow-lg p-3 sm:p-4 text-center transform hover:scale-105 transition-all duration-200 hover:shadow-xl">
                        <div class="inline-flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-green-500 to-green-600 rounded-full mb-1 sm:mb-2">
                            <i class="fas fa-user-shield text-white text-sm sm:text-lg"></i>
                        </div>
                        <p class="text-xs font-semibold text-gray-700">Secure</p>
                    </div>
                    <div class="bg-white rounded-xl sm:rounded-2xl shadow-lg p-3 sm:p-4 text-center transform hover:scale-105 transition-all duration-200 hover:shadow-xl">
                        <div class="inline-flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-full mb-1 sm:mb-2">
                            <i class="fas fa-check-circle text-white text-sm sm:text-lg"></i>
                        </div>
                        <p class="text-xs font-semibold text-gray-700">Protected</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .form-control:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }

    .card {
        border-radius: 10px;
    }
</style>
<script>
    (function () {
        function toggleVisibility(checkbox) {
            var targetId = checkbox.getAttribute('data-target');
            if (!targetId) return;
            var input = document.getElementById(targetId);
            if (!input) return;
            input.type = checkbox.checked ? 'text' : 'password';
        }

        // Real-time validation for login form
        function validateField(input) {
            var parent = input.closest('.relative.group');
            if (!parent) return;
            
            var fieldName = input.name;
            var value = input.value.trim();
            var isValid = true;
            var errorMsg = '';

            // Username/Email validation
            if (fieldName === 'username') {
                if (value.length < 3) {
                    isValid = false;
                    errorMsg = 'Username/Email must be at least 3 characters';
                }
            }

            // Password validation
            if (fieldName === 'password') {
                if (value.length < 1) {
                    isValid = false;
                    errorMsg = 'Password is required';
                }
            }

            // Apply visual feedback
            if (value === '') {
                // Empty field - remove all styling
                input.classList.remove('border-red-500', 'border-green-500', 'border-2');
                removeInlineError(parent);
            } else if (isValid) {
                // Valid field - green border
                input.classList.remove('border-red-500');
                input.classList.add('border-green-500', 'border-2');
                removeInlineError(parent);
            } else {
                // Invalid field - red border with error message
                input.classList.remove('border-green-500');
                input.classList.add('border-red-500', 'border-2');
                showInlineError(parent, errorMsg);
            }
        }

        function showInlineError(parent, message) {
            removeInlineError(parent);
            var errorDiv = document.createElement('div');
            errorDiv.className = 'inline-validation-error text-red-600 text-xs mt-1 animate-slide-up';
            errorDiv.innerHTML = '<i class="fas fa-exclamation-circle mr-1"></i>' + message;
            parent.appendChild(errorDiv);
        }

        function removeInlineError(parent) {
            var existing = parent.querySelector('.inline-validation-error');
            if (existing) {
                existing.remove();
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            document.querySelectorAll('.toggle-password').forEach(function (cb) {
                cb.addEventListener('change', function () { toggleVisibility(cb); });
            });
            
            // Add real-time validation to login inputs
            var formInputs = document.querySelectorAll('input[name="username"], input[name="password"]');
            formInputs.forEach(function(input) {
                // Validate on blur (when user leaves the field)
                input.addEventListener('blur', function() {
                    if (this.value.trim() !== '') {
                        validateField(this);
                    }
                });
                
                // Remove error styling when user starts typing
                input.addEventListener('input', function() {
                    if (this.classList.contains('border-red-500') && this.value.trim() !== '') {
                        validateField(this);
                    }
                });
            });
            
            // Auto scroll to error summary if there are errors
            var errorBox = document.querySelector('.border-red-500.shadow-lg');
            if (errorBox) {
                setTimeout(function() {
                    errorBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        });
    })();
</script>
{% endblock %}